<?phpclass Member extends CI_Controller {    public function __construct() {        parent::__construct();        $this->form_validation->set_error_delimiters($this->config->item('error_start_delimiter', 'ion_auth'), $this->config->item('error_end_delimiter', 'ion_auth'));        $this->load->library(array('ion_auth', 'form_validation', 'user_agent', 'upload'));        $this->load->helper(array('url'));        $this->load->database();        $this->lang->load('auth');    }    public function editprofil() {        $group = 'redaksi';        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $user = $this->ion_auth->user()->row();            $data['id'] = $user->id;            $data['id_reg'] = $user->id_reg;            $data['username'] = $user->first_name . ' ' . $user->last_name;            $data['email'] = $user->email;            $data['profil_picture'] = $user->picture;            $data['group_id'] = $this->ion_auth->get_users_groups()->row()->id;            $data['first_name'] = $user->first_name;            $data['last_name'] = $user->last_name;            $data['phone'] = $user->phone;            $data['address'] = $user->address;            $data['email'] = $user->email;            $data['datereg'] = $user->datereg;            $data['fb'] = $user->fb;            $data['tw'] = $user->tw;            $data['gp'] = $user->gp;            $data['ig'] = $user->ig;            $data['yt'] = $user->yt;            $data['linkedin'] = $user->linkedin;            $data['site_title'] = 'Edit Profile';            $data['menu'] = $this->blog_model->get_menu()->result_array();            $data_setting = $this->blog_model->get_setting()->result_array();            $data['keyword'] = $data_setting[0]['keyword'];            $data['description'] = $data_setting[0]['description'];            $this->load->view('page/head', $data);            $this->load->view('page/navbar');            $this->load->view('page/member/profileedit');            $this->load->view('page/footer');        }    }    public function setting() {        $group = 'redaksi';        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $user = $this->ion_auth->user()->row();            $data['id'] = $user->id;            $data['id_reg'] = $user->id_reg;            $data['username'] = $user->first_name . ' ' . $user->last_name;            $data['email'] = $user->email;            $data['profil_picture'] = $user->picture;            $data['group_id'] = $this->ion_auth->get_users_groups()->row()->id;            $data['site_title'] = 'Setting';            $data['menu'] = $this->blog_model->get_menu()->result_array();            $data_setting = $this->blog_model->get_setting()->result_array();            $data['keyword'] = $data_setting[0]['keyword'];            $data['description'] = $data_setting[0]['description'];            $data['message'] = (validation_errors()) ? validation_errors() : $this->session->flashdata('message');            $member_setting = $this->blog_model->get_member_setting()->result_array();            $data['setting_id'] = $member_setting[0]['id'];            $data['setting_id_reg'] = $member_setting[0]['id_reg'];            $data['not_social'] = $member_setting[0]['social'];            $data['not_content'] = $member_setting[0]['content'];            $data['total_scifi'] = $this->blog_model->get_cat_scifi();            $data['total_tech'] = $this->blog_model->get_cat_tech();            $data['total_sport'] = $this->blog_model->get_cat_sport();            $data['total_automotive'] = $this->blog_model->get_cat_automotive();            $data['total_video'] = $this->blog_model->get_cat_video();            $this->load->view('page/head', $data, array('error' => ' '));            $this->load->view('page/navbar');            $this->load->view('member/setting');            $this->load->view('page/footer');        }    }    function change_email() {        $group = array('redaksi');        $id = $this->input->post('id');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $query = null;            $query = $this->db->get_where('users', array(                'id' => $id            ));            $count = $query->num_rows();            if ($count != 0) {                $data = array(                    'email' => $this->input->post('email_baru')                );                $this->blog_model->update_data('users', $data, array('id' => $id));            }        }    }    function setting_notifikasi_social() {        $group = array('redaksi');        $id = $this->input->post('id');        $id_reg = $this->input->post('id_reg');        $post = $this->input->post('social');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $this->form_validation->set_rules('id', 'id', 'required');            if ($this->form_validation->run() == FALSE) {                redirect('member/setting/' . $id_reg . '', 'refresh');            } else {                $query = null;                $query = $this->db->get_where('member_setting', array(                    'id_reg' => $id_reg                ));                $count = $query->num_rows();                if ($count === 0) {                    if ($post == 'on') {                        $data = array(                            'id_reg' => $id_reg,                            'social' => '1',                        );                    } else {                        $data = array(                            'id_reg' => $id_reg,                            'social' => '0',                        );                    }                    $this->blog_model->insert_data('member_setting', $data);                } else {                    if ($post == 'on') {                        $data = array(                            'social' => '1',                        );                    } else {                        $data = array(                            'social' => '0',                        );                    }                    $this->blog_model->update_data('member_setting', $data, array('id' => $id));                }            }        }    }    function setting_notifikasi_content() {        $group = array('redaksi');        $id = $this->input->post('id');        $id_reg = $this->input->post('id_reg');        $post = $this->input->post('content');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $this->form_validation->set_rules('id', 'id', 'required');            if ($this->form_validation->run() == FALSE) {                redirect('member/setting/' . $id_reg . '', 'refresh');            } else {                $query = null;                $query = $this->db->get_where('member_setting', array(                    'id_reg' => $id_reg                ));                $count = $query->num_rows();                if ($count === 0) {                    if ($post == 'on') {                        $data = array(                            'id_reg' => $id_reg,                            'content' => '1',                        );                    } else {                        $data = array(                            'id_reg' => $id_reg,                            'content' => '0'                        );                    }                    $this->blog_model->insert_data('member_setting', $data);                } else {                    if ($post == 'on') {                        $data = array(                            'content' => '1',                        );                    } else {                        $data = array(                            'content' => '0'                        );                    }                    $this->blog_model->update_data('member_setting', $data, array('id' => $id));                }            }        }    }    public function mystories() {        $group = array('redaksi');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $user = $this->ion_auth->user()->row();            $data['id'] = $user->id;            $data['id_reg'] = $user->id_reg;            $data['username'] = $user->first_name . ' ' . $user->last_name;            $data['email'] = $user->email;            $data['profil_picture'] = $user->picture;            $data['group_id'] = $this->ion_auth->get_users_groups()->row()->id;            $data['site_title'] = 'Post';            $data['menu'] = $this->blog_model->get_menu()->result_array();            $data_setting = $this->blog_model->get_setting()->result_array();            $data['keyword'] = $data_setting[0]['keyword'];            $data['description'] = $data_setting[0]['description'];            $data['category'] = $this->blog_model->get_post_category()->result_array();            $data['postmember_active'] = $this->blog_model->get_post("WHERE id_reg ='$user->id_reg' AND active='Y' ORDER BY date DESC")->result_array();            $data['postmember_draft'] = $this->blog_model->get_post("WHERE id_reg ='$user->id_reg' AND active='N' ORDER BY date DESC")->result_array();            $data['error'] = ' ';            $data['message'] = (validation_errors()) ? validation_errors() : $this->session->flashdata('message');            $data['total_scifi'] = $this->blog_model->get_cat_scifi();            $data['total_tech'] = $this->blog_model->get_cat_tech();            $data['total_sport'] = $this->blog_model->get_cat_sport();            $data['total_automotive'] = $this->blog_model->get_cat_automotive();            $data['total_video'] = $this->blog_model->get_cat_video();            $this->load->view('page/head', $data, array('error' => ' '));            $this->load->view('page/navbar');            $this->load->view('member/my-stories');            $this->load->view('page/footer');        }    }    public function writestory() {        $group = array('redaksi');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $user = $this->ion_auth->user()->row();            $data['id'] = $user->id;            $data['id_reg'] = $user->id_reg;            $data['profil_picture'] = $user->picture;            $data['group_id'] = $this->ion_auth->get_users_groups()->row()->id;            $data['editor'] = $user->first_name . ' ' . $user->last_name;            $data['site_title'] = 'Dashboard';            $data['menu'] = $this->blog_model->get_menu()->result_array();            $data['all_tag'] = $this->blog_model->get_tags()->result_array();            $data['category'] = $this->blog_model->get_post_category()->result_array();            $data['tags'] = $this->blog_model->get_post_category()->result_array();            $data_setting = $this->blog_model->get_setting()->result_array();            $data['keyword'] = $data_setting[0]['keyword'];            $data['description'] = $data_setting[0]['description'];            $data['status'] = 'new';            $data['id_post'] = '';            $data['title'] = '';            $data['seotitle'] = '';            $data['image'] = '';            $data['content'] = '';            $data['id_tag'] = '';            $data['total_scifi'] = $this->blog_model->get_cat_scifi();            $data['total_tech'] = $this->blog_model->get_cat_tech();            $data['total_sport'] = $this->blog_model->get_cat_sport();            $data['total_automotive'] = $this->blog_model->get_cat_automotive();            $data['total_video'] = $this->blog_model->get_cat_video();            $this->load->view('page/head', $data);            $this->load->view('page/navbar');            $this->load->view('member/new-stories');            $this->load->view('page/footer');        }    }    public function postedit($code = 0) {        $group = array('redaksi');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $user = $this->ion_auth->user()->row();            $data['id'] = $user->id;            $data['id_reg'] = $user->id_reg;            $data['profil_picture'] = $user->picture;            $data['group_id'] = $this->ion_auth->get_users_groups()->row()->id;            $data['editor'] = $user->first_name . ' ' . $user->last_name;            $data['site_title'] = 'Edit Post';            $data['menu'] = $this->blog_model->get_menu()->result_array();            $data['all_tag'] = $this->blog_model->get_tags()->result_array();            $data['category'] = $this->blog_model->get_post_category()->result_array();            $data['tags'] = $this->blog_model->get_post_category()->result_array();            $data_setting = $this->blog_model->get_setting()->result_array();            $data['keyword'] = $data_setting[0]['keyword'];            $data['description'] = $data_setting[0]['description'];            $data_content = $this->blog_model->get_post("where id_post='$code'")->result_array();            $data['status'] = 'Edit';            $data['id_post'] = $data_content[0]['id_post'];            $data['title'] = $data_content[0]['title'];            $data['seotitle'] = $data_content[0]['seotitle'];            $data['image'] = $data_content[0]['image'];            $data['thumb'] = $data_content[0]['thumb'];            $data['content'] = $data_content[0]['content'];            $data['id_cat'] = $data_content[0]['category'];            $data['id_tag'] = $data_content[0]['tag'];            $data['total_scifi'] = $this->blog_model->get_cat_scifi();            $data['total_tech'] = $this->blog_model->get_cat_tech();            $data['total_sport'] = $this->blog_model->get_cat_sport();            $data['total_automotive'] = $this->blog_model->get_cat_automotive();            $data['total_video'] = $this->blog_model->get_cat_video();            $this->load->view('page/head', $data);            $this->load->view('page/navbar');            $this->load->view('member/new-stories');            $this->load->view('page/footer');        }    }    public function savepost() {        print_r($_POST);die();        $group = array('redaksi');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $this->form_validation->set_rules('title', 'title', 'required');            if ($this->form_validation->run() == FALSE) {                header('location:' . base_url('my-stories/' . $id_reg . ''));            } else {                $id_post = $this->input->post('id_post');                $id_reg = $this->input->post('id_reg');                $seotitle = $this->input->post('seotitle');                $status = $this->input->post('status');                $editor = $this->input->post('editor');                $tags = $this->input->post('tag');                if (!empty($tags)) {                    $tag = implode(',', $tags);                } else {                    $tag = $tags;                }                //UPLOAD PICTURE                   $type = explode(".", $_FILES['postimage']['name']);                $ext = end($type);                $path = APPPATH . '../assets/picture/';                //Kl ada image                if (!empty($type[0])) {                    $config['upload_path'] = APPPATH . '../assets/picture/';                    $config['allowed_types'] = 'gif|jpg|png|jpeg';                    $config['overwrite'] = TRUE;                    $config['remove_spaces'] = TRUE;                    $config['max_size'] = '2000';                    $config['max_width'] = '2000';                    $config['max_height'] = '2000';                    $file_name = $config['file_name'] = $id_post . '-' . $seotitle . '.' . $ext;                    $this->upload->initialize($config);                    $this->upload->do_upload('postimage');                    $this->load->library('image_lib');                    //Bikin Image Medium                    $config['source_image'] = APPPATH . '../assets/picture/' . $file_name . '';                    $config['new_image'] = APPPATH . '../assets/picture/medium/' . $file_name . '';                    $config['maintain_ratio'] = TRUE;                    $config['width'] = 700;                    $this->image_lib->initialize($config);                    $this->image_lib->resize();                    //Bikin Image Small                    $thumb['source_image'] = APPPATH . '../assets/picture/' . $file_name . '';                    $thumb['new_image'] = APPPATH . '../assets/picture/thumb/' . $file_name . '';                    $thumb['maintain_ratio'] = TRUE;                    $thumb['width'] = 300;                    $this->image_lib->initialize($thumb);                    $this->image_lib->resize();                    if (!is_dir($config['upload_path'])) {                        mkdir($config['upload_path'], 0777, TRUE);                        $error = array('error' => $this->upload->display_errors());                        header('location:' . base_url('my-stories/' . $id_reg . ''));                    }                    if (!$this->upload->do_upload('image')) {                        $error = array('error' => $this->upload->display_errors());                        header('location:' . base_url('my-stories/' . $id_reg . ''));                    }                    if ($status == "new") {                        $data = array(                            'date' => date("Y-m-d H:i:s"),                            'last_edit' => date('Y-m-d H:i:s'),                            'id_reg' => $id_reg,                            'title' => $this->input->post('title'),                            'seotitle' => $this->input->post('seotitle'),                            'category' => $this->input->post('category'),                            'content' => $this->input->post('content'),                            'image' => $file_name,                            'editor' => $editor,                            'tag' => $tag                        );                        $this->blog_model->insert_data('post', $data);                        header('location:' . base_url('my-stories/' . $id_reg . ''));                    } else {                        $data = array(                            'id_reg' => $this->input->post('id_reg'),                            'title' => $this->input->post('title'),                            'category' => $this->input->post('category'),                            'seotitle' => $this->input->post('seotitle'),                            'content' => $this->input->post('content'),                            'editor' => $editor,                            'tag' => $tag,                            'image' => $file_name                        );                        $this->blog_model->update_data('post', $data, array('id_post' => $id_post));                        header('location:' . base_url('my-stories/' . $id_reg . ''));                    }                    //Kl gak ada image                } else {                    if ($status == "") {                        $data = array(                            'date' => date("Y-m-d H:i:s"),                            'last_edit' => date('Y-m-d H:i:s'),                            'id_reg' => $id_reg,                            'title' => $this->input->post('title'),                            'seotitle' => $this->input->post('seotitle'),                            'category' => $this->input->post('category'),                            'content' => $this->input->post('content'),                            'editor' => $editor,                            'tag' => implode(',', $this->input->post('tag'))                        );                        $this->blog_model->insert_data('post', $data);                        header('location:' . base_url('my-stories/' . $id_reg . ''));                    } else {                        $data = array(                            'last_edit' => date('Y-m-d H:i:s'),                            'id_reg' => $this->input->post('id_reg'),                            'title' => $this->input->post('title'),                            'category' => $this->input->post('category'),                            'seotitle' => $this->input->post('seotitle'),                            'content' => $this->input->post('content'),                            'editor' => $editor,                            'tag' => implode(',', $this->input->post('tag'))                        );                        $this->blog_model->update_data('post', $data, array('id_post' => $id_post));                        header('location:' . base_url('my-stories/' . $id_reg . ''));                    }                }            }        }    }    function coverupdate() {        $group = array('redaksi');        $id = $this->input->post('id');        $id_reg = $this->input->post('id_reg');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $this->form_validation->set_rules('id', 'id', 'required');            if ($this->form_validation->run() == FALSE) {                $this->session->set_flashdata('message', '<div class="alert alert-danger text-center alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>Oops! Error.  Please try again !!!</div>');                header('location:' . base_url('profile/' . $id_reg . ''));            } else {                 $type = explode(".", $_FILES['picture']['name']);                $ext = end($type);                $config['upload_path'] = APPPATH . '../assets/member/' . $id_reg . '';                $config['allowed_types'] = 'gif|jpg|png|jpeg';                $config['overwrite'] = TRUE;                $config['remove_spaces'] = TRUE;                $config['max_size'] = '1000';                $config['max_width'] = '2000';                $config['max_height'] = '8000';                $file_name = $config['file_name'] = 'cover-id-' . $id_reg . '.' . $ext;                $this->upload->initialize($config);                $this->upload->do_upload('picture');                $this->load->library('image_lib');                $this->upload->overwrite = TRUE;                                 if (!$this->upload->do_upload('picture')) {                    $error = array('error' => $this->upload->display_errors());                    $this->session->set_flashdata('message', 'Upload Gagal!');                    header('location:' . base_url('profile/' . $id_reg . ''));                } else {                    $data = array(                        'cover' => $file_name                    );                    $this->session->set_flashdata('message', 'Upload Sukses!');                    $this->blog_model->update_data('users', $data, array('id' => $id));                                     }            }        }    }        function fotoupdate() {        $group = array('redaksi');        $id = $this->input->post('id');        $id_reg = $this->input->post('id_reg');        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $this->form_validation->set_rules('id', 'id', 'required');            if ($this->form_validation->run() == FALSE) {                $this->session->set_flashdata('message', '<div class="alert alert-danger text-center alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>Oops! Error.  Please try again !!!</div>');                header('location:' . base_url('profile/' . $id_reg . ''));            } else {                //UPLOAD PICTURE                $type = explode(".", $_FILES['picture']['name']);                $ext = end($type);                $config['upload_path'] = APPPATH . '../assets/member/' . $id_reg . '';                $config['allowed_types'] = 'gif|jpg|png|jpeg';                $config['overwrite'] = TRUE;                $config['remove_spaces'] = TRUE;                $config['max_size'] = '1000';                $config['max_width'] = '1000';                $config['max_height'] = '1000';                $file_name = $config['file_name'] = 'profil-id-' . $id_reg . '.' . $ext;                $this->upload->initialize($config);                $this->upload->do_upload('picture');                $this->load->library('image_lib');                $this->upload->overwrite = TRUE;                $config['source_image'] = APPPATH . '../assets/member/' . $id_reg . '/' . $file_name . '';                $config['new_image'] = APPPATH . '../assets/member/' . $id_reg . '/thumb/' . $file_name . '';                $config['maintain_ratio'] = TRUE;                $config['width'] = 80;                $this->image_lib->initialize($config);                $this->image_lib->resize();                if (!$this->upload->do_upload('picture')) {                    $error = array('error' => $this->upload->display_errors());                    $this->session->set_flashdata('message', 'Upload Gagal!');                    header('location:' . base_url('profile/' . $id_reg . ''));                } else {                    $data = array(                        'picture' => $file_name                    );                    $this->session->set_flashdata('message', 'Upload Sukses!');                    $this->blog_model->update_data('users', $data, array('id' => $id));                                     }            }        }    }    function profilupdate($id = NULL) {        $group = 'redaksi';        if (!$this->ion_auth->logged_in() || !$this->ion_auth->in_group($group)) {            redirect('login', 'refresh');        } else {            $this->form_validation->set_rules('email', 'email', 'required');            if ($this->form_validation->run() == FALSE) {                $this->session->set_flashdata('message', '<div class="alert alert-danger text-center alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>Oops! Error.  Please try again !!!</div>');                header('location:' . base_url('member/editprofil'));            } else {                $id = $this->input->post('id');                if ($this->input->post('password') == "") {                    $data = array(                        'first_name' => $this->input->post('first_name'),                        'last_name' => $this->input->post('last_name'),                        'phone' => $this->input->post('phone'),                        'address' => $this->input->post('address'),                        'email' => $this->input->post('email'),                        'fb' => $this->input->post('fb'),                        'yt' => $this->input->post('yt'),                        'ig' => $this->input->post('ig'),                        'tw' => $this->input->post('tw'),                        'linkedin' => $this->input->post('linkedin'),                    );                } else {                    $data = array(                        'first_name' => $this->input->post('first_name'),                        'last_name' => $this->input->post('last_name'),                        'phone' => $this->input->post('phone'),                        'address' => $this->input->post('address'),                        'email' => $this->input->post('email'),                        'fb' => $this->input->post('fb'),                        'yt' => $this->input->post('yt'),                        'ig' => $this->input->post('ig'),                        'tw' => $this->input->post('tw'),                        'linkedin' => $this->input->post('linkedin'),                        'password' => $this->input->post('password'),                    );                }                if ($this->ion_auth->update($id, $data)) {                    header('location:' . base_url() . "member/dashboard");                } else {                    header('location:' . base_url() . "member/editprofile");                }            }        }    }    function deletepost($code = 0) {        $group = 'redaksi';        if (!$this->ion_auth->logged_in()) {            redirect('login', 'refresh');        } else {            $this->blog_model->delete_data('post', array('id_post' => $code));            header('location:' . base_url('member/post'));        }    }}